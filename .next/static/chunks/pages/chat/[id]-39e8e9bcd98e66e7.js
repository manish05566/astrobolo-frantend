(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[688],{8220:(e,a,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat/[id]",function(){return s(8881)}])},8881:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>v});var t=s(7876),l=s(8230),r=s.n(l),n=s(7163);let c=(0,s(1713).A)("camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);var i=s(26),o=s(6143),d=s(4232),m=s(2491),h=s.n(m),u=s(6460),f=s(8581);let g=function(e){let{data:a}=e,{messages:s,input:l,setInput:m,balance:g,remainingTime:x,formatTime:p,sendMessage:j,sendImageMessage:v,handleEndChat:N,setEndClicked:b}=(0,o.A)(a,"customer",()=>{h().fire("Your chat balance has ended","","info"),N(!0)}),y=(0,d.useRef)(null),w=(0,d.useRef)(null);(0,d.useEffect)(()=>{let e=new URL(window.location.href);e.searchParams.get("r")||(e.searchParams.set("r","1"),window.location.replace(e.toString()))},[]),(0,d.useEffect)(()=>{var e;null==(e=y.current)||e.scrollIntoView({behavior:"smooth"})},[s]);let _=async e=>{let a=e.target.files[0];if(a&&a.type.startsWith("image/")){let e=new FormData;e.append("file",a);try{let a=await (0,f.W)("".concat(u.v.base_url,"chat/upload-image"),{method:"POST",body:e});if(!a.ok){let e=await a.text();throw Error("Image upload failed: ".concat(e))}let s=await a.json(),t="".concat(u.v.base_url.replace(/\/$/,""),"/").concat(null==s?void 0:s.url.replace(/^\//,""));v(t)}catch(e){console.error(e),h().fire("Upload Failed",e.message,"error")}}};return(0,t.jsx)("div",{className:"chat-bg",children:(0,t.jsx)("div",{className:"container py-4",children:(0,t.jsx)("div",{className:"row justify-content-center",children:(0,t.jsxs)("div",{className:"col-lg-9",style:{marginTop:"122px"},children:[(0,t.jsxs)("div",{className:"chat-header d-flex align-items-center justify-content-between",children:[(0,t.jsxs)("div",{className:"d-flex align-items-center",children:[(0,t.jsx)("img",{src:(null==a?void 0:a.image)||"/images/userprofile.png",alt:"avatar",className:"rounded-circle border border-2 border-dark p-1",style:{width:"32px",height:"32px",objectFit:"cover"}}),(0,t.jsxs)("div",{className:"user-info ms-2",children:[(0,t.jsx)("h6",{className:"mb-0",children:null==a?void 0:a.first_name}),(0,t.jsxs)("small",{children:["Balance: (",p(x)," mins)"]}),(0,t.jsx)("br",{}),(0,t.jsx)("small",{children:"Chat in progress."})]})]}),(0,t.jsx)(r(),{href:"#",onClick:e=>{e.preventDefault(),b(),N(!1)},className:"btn btn-outline-info btn-sm",children:"End"})]}),(0,t.jsx)("div",{className:"chat-body",children:(0,t.jsxs)("div",{className:"d-flex flex-column",children:[s.map((e,a)=>(0,t.jsxs)("div",{className:"mb-2 p-2 ".concat(e.isSent?"chat-message align-self-end":"chat-message-left align-self-start"," rounded"),children:[e.isImage?(0,t.jsx)("img",{src:e.message,alt:"sent",style:{maxWidth:"200px",borderRadius:"10px"}}):(0,t.jsx)("p",{className:"mb-0",children:e.message}),(0,t.jsx)("small",{className:"d-block text-muted text-end text-offwhite",children:e.time})]},a)),(0,t.jsx)("div",{ref:y})]})}),(0,t.jsxs)("div",{className:"chat-footer",children:[(0,t.jsxs)("div",{className:"input-group",children:[(0,t.jsx)("span",{className:"input-group-text",children:(0,t.jsx)(n.A,{className:"icon"})}),(0,t.jsx)("input",{type:"text",className:"form-control",placeholder:"Type a message...",value:l,onChange:e=>m(e.target.value),onKeyDown:e=>"Enter"===e.key&&j()}),(0,t.jsx)("button",{className:"btn btn-light",onClick:()=>w.current.click(),children:(0,t.jsx)(c,{className:"icon"})}),(0,t.jsx)("button",{className:"btn btn-primary",onClick:j,children:(0,t.jsx)(i.A,{className:"icon"})})]}),(0,t.jsx)("input",{type:"file",ref:w,accept:"image/*",style:{display:"none"},onChange:_})]})]})})})})};var x=s(9099),p=s(432),j=s(3276);let v=()=>{let{id:e}=(0,x.useRouter)().query,[a,s]=(0,d.useState)(null),[l,r]=(0,d.useState)(!0);return(0,d.useEffect)(()=>{let a=localStorage.getItem("token"),t=JSON.parse(localStorage.getItem("user")),l=null==t?void 0:t.user.id,n=null==t?void 0:t.type;if(!l||!n)return void console.error("Missing userId or userType");!(!a||(0,j.H)(a))&&"user"===n&&e&&(0,f.W)("".concat(u.v.base_url,"vendors/").concat(e)).then(e=>e.json()).then(e=>{let a=null==e?void 0:e.data;a&&s({id:a.id,first_name:a.first_name,chat_charge:a.chat_charge,image:a.image||"/images/userprofile.png"})}).catch(e=>console.error("Error fetching detail",e)).finally(()=>r(!1))},[e]),(0,p.A)(),(0,t.jsx)("div",{className:"chat-astrologer",children:(0,t.jsx)(g,{data:a})})}}},e=>{e.O(0,[692,491,679,636,593,792],()=>e(e.s=8220)),_N_E=e.O()}]);