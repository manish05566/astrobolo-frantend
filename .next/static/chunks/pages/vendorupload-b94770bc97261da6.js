(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[961],{1360:(e,a,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/vendorupload",function(){return t(4970)}])},4970:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>u});var s=t(7876),r=t(4232),l=t(5438),n=t(6460),o=t(8581);let i=()=>(0,s.jsx)("svg",{className:"upload_svg mb-2",width:"60",height:"60",viewBox:"0 0 96 96",children:(0,s.jsx)("path",{d:"M47 6a21 21 0 0 0-12.3 3.8c-2.7 2.1-4.4 5-4.7 7.1-5.8 1.2-10.3 5.6-10.3 10.6 0 6 5.8 11 13 11h12.6V22.7l-7.1 6.8c-.4.3-.9.5-1.4.5-1 0-2-.8-2-1.7 0-.4.3-.9.6-1.2l10.3-8.8c.3-.4.8-.6 1.3-.6.6 0 1 .2 1.4.6l10.2 8.8c.4.3.6.8.6 1.2 0 1-.9 1.7-2 1.7-.5 0-1-.2-1.3-.5l-7.2-6.8v15.6h14.4c6.1 0 11.2-4.1 11.2-9.4 0-5-4-8.8-9.5-9.4C63.8 11.8 56 5.8 47 6Zm-1.7 42.7V38.4h3.4v10.3c0 .8-.7 1.5-1.7 1.5s-1.7-.7-1.7-1.5ZM27 49c-4 0-7 2-7 6v29c0 3 3 6 6 6h42c3 0 6-3 6-6V55c0-4-3-6-7-6H28Zm41 3c1 0 3 1 3 3v19l-13-6a2 2 0 0 0-2 0L44 79l-10-5a2 2 0 0 0-2 0l-9 7V55c0-2 2-3 4-3h41ZM40 62c0 2-2 4-5 4s-5-2-5-4 2-4 5-4 5 2 5 4Z"})}),d=e=>{let{title:a,inputId:t,onFilesChange:l,preview:n}=e,[o,d]=(0,r.useState)(n||""),c=(0,r.useRef)(null);return(0,r.useEffect)(()=>{n&&d(n)},[n]),(0,r.useEffect)(()=>{let e=c.current,a=e.querySelector('input[type="file"]'),s=e=>{e.preventDefault(),e.stopPropagation()},r=()=>e.classList.add("highlight"),n=()=>e.classList.remove("highlight"),o=e=>{let a=[...e.dataTransfer.files].filter(e=>["image/jpeg","image/png","image/svg+xml"].includes(e.type));a.length&&u(a)},i=e=>{let a=[...e.target.files].filter(e=>["image/jpeg","image/png","image/svg+xml"].includes(e.type));a.length&&u(a)},u=e=>{let a=new FileReader;a.onloadend=()=>{d(a.result)},a.readAsDataURL(e[0]),l(t,e)};return["dragenter","dragover","dragleave","drop"].forEach(a=>e.addEventListener(a,s,!1)),["dragenter","dragover"].forEach(a=>e.addEventListener(a,r,!1)),["dragleave","drop"].forEach(a=>e.addEventListener(a,n,!1)),e.addEventListener("drop",o,!1),a.addEventListener("change",i,!1),()=>{["dragenter","dragover","dragleave","drop"].forEach(a=>{e.removeEventListener(a,s,!1),e.removeEventListener(a,r,!1),e.removeEventListener(a,n,!1)}),e.removeEventListener("drop",o,!1),a.removeEventListener("change",i,!1)}},[t,l]),(0,s.jsx)("div",{className:"col-lg-4 col-md-4 mb-4",children:(0,s.jsx)("div",{className:"card p-2 shadow-sm",children:(0,s.jsxs)("fieldset",{ref:c,className:"upload_dropZone text-center p-1 border border-2 border-dashed rounded",children:[(0,s.jsx)("legend",{className:"visually-hidden",children:a}),(0,s.jsx)(i,{}),(0,s.jsxs)("p",{className:"small my-1",children:[a,(0,s.jsx)("br",{}),(0,s.jsx)("i",{children:"or"})]}),(0,s.jsx)("input",{id:t,className:"position-absolute invisible",type:"file",multiple:!0,accept:"image/jpeg, image/png, image/svg+xml"}),(0,s.jsx)("label",{className:"btn btn-theme mt-2",htmlFor:t,children:"Select File"}),o&&(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsx)("label",{className:"fw-semibold d-block",children:"Preview:"}),(0,s.jsx)("img",{src:o,alt:t,style:{maxWidth:"160px",borderRadius:"8px"}})]})]})})})},c=e=>{let{}=e,[a,t]=(0,r.useState)({}),[l,i]=(0,r.useState)(""),[c,u]=(0,r.useState)(""),[m,h]=(0,r.useState)(""),[p,v]=(0,r.useState)({});(0,r.useEffect)(()=>{var e;let a=localStorage.getItem("token"),t=localStorage.getItem("user");console.log("userDataRaw",t);let s=JSON.parse(t),r=null==s||null==(e=s.user)?void 0:e.id;r||console.error("Vendor ID not found 1"),(async()=>{try{let e=await (0,o.W)("".concat(n.v.base_url,"vendors/").concat(r),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)}}),t=await e.json();console.log("response data vendor",t.data),v(t.data)}catch(e){console.error("Error fetching profile:",e)}})()},[]);let g=(e,a)=>{t(t=>({...t,[e]:a}))},f=()=>{var e,t;return(null==(e=a.document1)?void 0:e.length)>0&&(null==(t=a.document2)?void 0:t.length)>0},x=async()=>{var e;let s=localStorage.getItem("token"),r=JSON.parse(localStorage.getItem("user")),l=null==r||null==(e=r.user)?void 0:e.id;if(i(""),u(""),h(""),!f())return void i("Both Aadhaar and PAN card documents are required.");let d=new FormData;for(let e of(d.append("document1",a.document1[0]),d.append("document2",a.document2[0]),d.entries()))console.log(e[0]+": ",e[1]);try{let e=await (0,o.W)("".concat(n.v.base_url,"vendors/upload-documents/").concat(l),{method:"PUT",headers:{Authorization:"Bearer ".concat(s)},body:d}),a=await e.json();console.log("response result",a),e.ok&&a.status?(u("Documents uploaded successfully!"),t({})):h(a.message||"Upload failed. Try again.")}catch(e){console.error(e),i("Upload failed. Please try again.")}};return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"text-center fw-semibold text-secondary mb-3",children:["\uD83D\uDCC4 Please upload both ",(0,s.jsx)("strong",{children:"Aadhaar"})," and"," ",(0,s.jsx)("strong",{children:"PAN card"})," to enable submission."]}),(0,s.jsx)("div",{className:"container-fluid",children:(0,s.jsx)("div",{className:"row",children:(0,s.jsxs)("div",{className:"col-lg-9",children:[(0,s.jsxs)("div",{className:"row",children:[(0,s.jsx)(d,{title:"Upload Aadhaar Card",inputId:"document1",onFilesChange:g,preview:null==p?void 0:p.document1}),(0,s.jsx)(d,{title:"Upload PAN Card",inputId:"document2",onFilesChange:g,preview:null==p?void 0:p.document2})]}),(0,s.jsxs)("div",{className:"mt-4",children:[l&&(0,s.jsx)("div",{className:"alert alert-danger",children:l}),c&&(0,s.jsx)("div",{className:"alert alert-success",children:c}),m&&(0,s.jsx)("div",{className:"alert alert-danger",children:m}),f()&&(0,s.jsx)("div",{className:"d-flex justify-content-center mt-4 mb-5",children:(0,s.jsx)("button",{className:"btn px-5 py-2 shadow rounded-pill",style:{backgroundColor:"#8f6f9e",color:"white"},onClick:x,children:"\uD83D\uDE80 Submit Files"})})]})]})})})]})},u=function(){return(0,s.jsx)("div",{className:"bg-light sectiontop-margin",children:(0,s.jsx)("div",{className:"container-fluid pb-5 pt-0",children:(0,s.jsx)("div",{className:"row",children:(0,s.jsx)("div",{className:"col-12",children:(0,s.jsx)("div",{className:"card border-0 shadow-sm",children:(0,s.jsx)("div",{className:"card-body p-0",children:(0,s.jsxs)("div",{className:"row g-0",children:[(0,s.jsx)("div",{className:"col-lg-3 border-end",children:(0,s.jsx)(l.A,{})}),(0,s.jsx)("div",{className:"col-lg-9",children:(0,s.jsx)(c,{})})]})})})})})})})}},5438:(e,a,t)=>{"use strict";t.d(a,{A:()=>u});var s=t(7876),r=t(4232),l=t(8230),n=t.n(l),o=t(6460),i=t(8581),d=t(9099);let c=function(){let[e,a]=(0,r.useState)(null),[t,l]=(0,r.useState)(null),[n,d]=(0,r.useState)(""),[c,u]=(0,r.useState)(""),[m,h]=(0,r.useState)("/images/userprofile.png"),[p,v]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=localStorage.getItem("user");if(e){let a=JSON.parse(e),t=null==a?void 0:a.user,s=null==a?void 0:a.type;(null==t?void 0:t.id)&&"vendor"===s?(v(t.id),g(t.id)):console.warn("User type is not 'user' or ID is missing")}},[]);let g=async e=>{let t=localStorage.getItem("token");if(!e||!t)return void console.warn("Missing ID or token");try{let s=await (0,i.W)("".concat(o.v.base_url,"vendors/").concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(t)}});if(!s.ok)throw Error("HTTP error! status: ".concat(s.status));let r=await s.json();if(s.ok&&r.data){let e=r.data.image||"/images/userprofile.png";h(e),a(r.data)}}catch(e){console.error("Error fetching user:",e)}},f=async()=>{if(!t||!p)return;let e=new FormData;e.append("image",t);try{let a=localStorage.getItem("token"),t=await (0,i.W)("".concat(o.v.base_url,"vendors/upload-profile/").concat(p),{method:"PUT",headers:{Authorization:"Bearer ".concat(a)},body:e}),s=await t.json();if(t.ok&&s.status){let e=s.data||"/images/userprofile.png";h("".concat(e,"?").concat(Date.now())),l(null)}else d(s.message||"Upload failed. Try again."),u("error")}catch(e){console.error("Upload error:",e),alert("Something went wrong while uploading.")}};return(0,s.jsxs)("div",{className:"text-center user-photo",children:[(0,s.jsxs)("div",{className:"position-relative d-inline-block",children:[(0,s.jsx)("img",{src:m,className:"rounded-circle profile-pic img-thumbnail",alt:"Profile",width:"120",height:"120"}),(0,s.jsx)("label",{htmlFor:"upload-photo",className:"btn btn-primary btn-sm position-absolute bottom-0 end-0 rounded-circle",title:"Change Photo",style:{cursor:"pointer"},children:(0,s.jsx)("i",{className:"fas fa-camera"})}),(0,s.jsx)("input",{type:"file",id:"upload-photo",accept:"image/*",onChange:e=>{var a;let t=null==(a=e.target.files)?void 0:a[0];if(t){if(t.size/1024>50){d("Image size should be 50KB or less."),u("error"),l(null);return}d(""),u(""),l(t),h(URL.createObjectURL(t))}},style:{display:"none"}})]}),(0,s.jsxs)("div",{className:"mt-2",children:[n&&(0,s.jsx)("p",{style:{color:"success"===c?"green":"red",fontSize:"0.75rem",margin:0},children:n}),!n&&t&&(0,s.jsx)("button",{className:"btn btn-success btn-sm",style:{fontSize:"0.75rem",padding:"2px 8px"},onClick:()=>f(t),children:"Upload"})]}),(0,s.jsxs)("p",{className:"mt-2 mb-1 profile-name fw-bold",children:[null==e?void 0:e.first_name," ",null==e?void 0:e.last_name]}),(0,s.jsxs)("p",{className:"text-muted mb-3 profile-number",children:["(+91 ",null==e?void 0:e.mobile,")"]})]})},u=function(){let e=(0,d.useRouter)();e.pathname;let[a,t]=(0,r.useState)(0),l=async()=>{var a,s;let r=localStorage.getItem("token"),l=JSON.parse(localStorage.getItem("user")),n=null==l||null==(a=l.user)?void 0:a.id;if(n&&"/vendorchat"!==e.pathname){if("true"===sessionStorage.getItem("resetUnread"))return void sessionStorage.removeItem("resetUnread");try{let e=await (0,i.W)("".concat(o.v.base_url,"chat/unread-count/").concat(n),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)}}),a=await e.json();"number"==typeof(null==a||null==(s=a.data)?void 0:s.unreadCount)?(t(a.data.unreadCount),Array.isArray(a.data.customerIds)&&a.data.customerIds.length>0&&sessionStorage.setItem("latestCustomerId",a.data.customerIds[0])):console.warn("Unexpected unread count structure:",null==a?void 0:a.data)}catch(e){console.error("Failed to fetch unread count",e)}}};return(0,r.useEffect)(()=>{if("/vendorchat"===e.pathname)return void t(0);l();let a=setInterval(()=>{l()},5e3);return()=>clearInterval(a)},[e.pathname]),(0,s.jsx)("div",{className:"p-4 pt-0 Sidebar",children:(0,s.jsxs)("div",{className:"nav flex-column nav-pills leftbar",children:[(0,s.jsx)("div",{className:"profile-ph-part",children:(0,s.jsx)(c,{})}),(0,s.jsxs)("div",{className:"left-menu py-3",children:[(0,s.jsx)(n(),{href:"vendor",className:"nav-link border-bottom",children:"Personal Info"}),(0,s.jsx)(n(),{href:"/astrologerTransaction",className:"nav-link border-bottom",children:"Transaction"}),(0,s.jsx)(n(),{href:"/vendorupload",className:"nav-link border-bottom",children:"Upload Documents"}),(0,s.jsxs)(n(),{href:"/vendor-requests",className:"nav-link border-bottom d-flex justify-content-between align-items-center",children:["Notifications ",(0,s.jsx)("span",{children:a})]})]})]})})}}},e=>{e.O(0,[636,593,792],()=>e(e.s=1360)),_N_E=e.O()}]);