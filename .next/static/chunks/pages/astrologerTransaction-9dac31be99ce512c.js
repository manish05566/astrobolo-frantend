(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[380],{313:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var s=a(7876),r=a(432),n=a(4232);a(8230);var l=a(6460),o=a(8581);let i=function(){let[e,t]=(0,n.useState)([]),[a,r]=(0,n.useState)(0);return(0,n.useEffect)(()=>{(async()=>{var e;let a=localStorage.getItem("token"),s=JSON.parse(localStorage.getItem("user")||"{}"),n=null==s||null==(e=s.user)?void 0:e.id;if(a&&n)try{let e=await (0,o.W)("".concat(l.v.base_url,"payment/").concat(n,"/astrologer/transactions"),{method:"GET",headers:{Authorization:"Bearer ".concat(a)}}),s=await e.json();s.status&&s.data?(r(s.data.balance||0),t(s.data.transactions||[])):(r(0),t([]))}catch(e){console.error("Failed to fetch wallet data",e),r(0),t([])}})()},[]),(0,s.jsxs)("div",{className:"p-4 rounded bg-light",children:[(0,s.jsx)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:(0,s.jsxs)("div",{className:"h5 mb-0",children:["Earn balance: ",(0,s.jsxs)("span",{className:"text-success",children:["₹ ",a]})]})}),(0,s.jsx)("div",{className:"table-responsive",children:(0,s.jsxs)("table",{className:"table table-bordered table-hover",children:[(0,s.jsx)("thead",{className:"table-light",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Description"}),(0,s.jsx)("th",{children:"Minuts"}),(0,s.jsx)("th",{children:"Transaction Amount"}),(0,s.jsx)("th",{children:"Datetime"})]})}),(0,s.jsx)("tbody",{children:0===e.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:5,className:"text-center",children:"No transactions found"})}):e.map((e,t)=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:"Chat with customer"}),(0,s.jsx)("td",{children:e.minuts||"-"}),(0,s.jsxs)("td",{className:"text-success",children:["₹ ",e.amount]}),(0,s.jsx)("td",{children:e.datetime})]},t))})]})})]})};var c=a(5438);function d(){return(0,r.A)(),(0,s.jsx)("div",{className:"bg-light ",style:{marginTop:"130px"},children:(0,s.jsx)("div",{className:"container-fluid pb-5 pt-0",children:(0,s.jsx)("div",{className:"row",children:(0,s.jsx)("div",{className:"col-12",children:(0,s.jsx)("div",{className:"card border-0 shadow-sm",children:(0,s.jsx)("div",{className:"card-body p-0",children:(0,s.jsxs)("div",{className:"row g-0",children:[(0,s.jsx)("div",{className:"col-lg-3 border-end testClass",children:(0,s.jsx)(c.A,{})}),(0,s.jsx)("div",{className:"col-lg-9",children:(0,s.jsx)(i,{})})]})})})})})})})}},2810:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/astrologerTransaction",function(){return a(313)}])},5438:(e,t,a)=>{"use strict";a.d(t,{A:()=>u});var s=a(7876),r=a(4232),n=a(8230),l=a.n(n),o=a(6460),i=a(8581),c=a(9099);let d=function(){let[e,t]=(0,r.useState)(null),[a,n]=(0,r.useState)(null),[l,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(""),[m,h]=(0,r.useState)("/images/userprofile.png"),[p,v]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=localStorage.getItem("user");if(e){let t=JSON.parse(e),a=null==t?void 0:t.user,s=null==t?void 0:t.type;(null==a?void 0:a.id)&&"vendor"===s?(v(a.id),x(a.id)):console.warn("User type is not 'user' or ID is missing")}},[]);let x=async e=>{let a=localStorage.getItem("token");if(!e||!a)return void console.warn("Missing ID or token");try{let s=await (0,i.W)("".concat(o.v.base_url,"vendors/").concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(a)}});if(!s.ok)throw Error("HTTP error! status: ".concat(s.status));let r=await s.json();if(s.ok&&r.data){let e=r.data.image||"/images/userprofile.png";h(e),t(r.data)}}catch(e){console.error("Error fetching user:",e)}},f=async()=>{if(!a||!p)return;let e=new FormData;e.append("image",a);try{let t=localStorage.getItem("token"),a=await (0,i.W)("".concat(o.v.base_url,"vendors/upload-profile/").concat(p),{method:"PUT",headers:{Authorization:"Bearer ".concat(t)},body:e}),s=await a.json();if(a.ok&&s.status){let e=s.data||"/images/userprofile.png";h("".concat(e,"?").concat(Date.now())),n(null)}else c(s.message||"Upload failed. Try again."),u("error")}catch(e){console.error("Upload error:",e),alert("Something went wrong while uploading.")}};return(0,s.jsxs)("div",{className:"text-center user-photo",children:[(0,s.jsxs)("div",{className:"position-relative d-inline-block",children:[(0,s.jsx)("img",{src:m,className:"rounded-circle profile-pic img-thumbnail",alt:"Profile",width:"120",height:"120"}),(0,s.jsx)("label",{htmlFor:"upload-photo",className:"btn btn-primary btn-sm position-absolute bottom-0 end-0 rounded-circle",title:"Change Photo",style:{cursor:"pointer"},children:(0,s.jsx)("i",{className:"fas fa-camera"})}),(0,s.jsx)("input",{type:"file",id:"upload-photo",accept:"image/*",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(a){if(a.size/1024>50){c("Image size should be 50KB or less."),u("error"),n(null);return}c(""),u(""),n(a),h(URL.createObjectURL(a))}},style:{display:"none"}})]}),(0,s.jsxs)("div",{className:"mt-2",children:[l&&(0,s.jsx)("p",{style:{color:"success"===d?"green":"red",fontSize:"0.75rem",margin:0},children:l}),!l&&a&&(0,s.jsx)("button",{className:"btn btn-success btn-sm",style:{fontSize:"0.75rem",padding:"2px 8px"},onClick:()=>f(a),children:"Upload"})]}),(0,s.jsxs)("p",{className:"mt-2 mb-1 profile-name fw-bold",children:[null==e?void 0:e.first_name," ",null==e?void 0:e.last_name]}),(0,s.jsxs)("p",{className:"text-muted mb-3 profile-number",children:["(+91 ",null==e?void 0:e.mobile,")"]})]})},u=function(){let e=(0,c.useRouter)();e.pathname;let[t,a]=(0,r.useState)(0),n=async()=>{var t,s;let r=localStorage.getItem("token"),n=JSON.parse(localStorage.getItem("user")),l=null==n||null==(t=n.user)?void 0:t.id;if(l&&"/vendorchat"!==e.pathname){if("true"===sessionStorage.getItem("resetUnread"))return void sessionStorage.removeItem("resetUnread");try{let e=await (0,i.W)("".concat(o.v.base_url,"chat/unread-count/").concat(l),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)}}),t=await e.json();"number"==typeof(null==t||null==(s=t.data)?void 0:s.unreadCount)?(a(t.data.unreadCount),Array.isArray(t.data.customerIds)&&t.data.customerIds.length>0&&sessionStorage.setItem("latestCustomerId",t.data.customerIds[0])):console.warn("Unexpected unread count structure:",null==t?void 0:t.data)}catch(e){console.error("Failed to fetch unread count",e)}}};return(0,r.useEffect)(()=>{if("/vendorchat"===e.pathname)return void a(0);n();let t=setInterval(()=>{n()},5e3);return()=>clearInterval(t)},[e.pathname]),(0,s.jsx)("div",{className:"p-4 pt-0 Sidebar",children:(0,s.jsxs)("div",{className:"nav flex-column nav-pills leftbar",children:[(0,s.jsx)("div",{className:"profile-ph-part",children:(0,s.jsx)(d,{})}),(0,s.jsxs)("div",{className:"left-menu py-3",children:[(0,s.jsx)(l(),{href:"vendor",className:"nav-link border-bottom",children:"Personal Info"}),(0,s.jsx)(l(),{href:"/astrologerTransaction",className:"nav-link border-bottom",children:"Transaction"}),(0,s.jsx)(l(),{href:"/vendorupload",className:"nav-link border-bottom",children:"Upload Documents"}),(0,s.jsxs)(l(),{href:"/vendor-requests",className:"nav-link border-bottom d-flex justify-content-between align-items-center",children:["Notifications ",(0,s.jsx)("span",{children:t})]})]})]})})}}},e=>{e.O(0,[636,593,792],()=>e(e.s=2810)),_N_E=e.O()}]);