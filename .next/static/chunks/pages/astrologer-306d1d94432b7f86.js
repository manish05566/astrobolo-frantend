(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[516],{3484:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/astrologer",function(){return s(5393)}])},5393:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>f});var a=s(7876),l=s(4232),n=s(8230),o=s.n(n);let c=function(e){let{specialistList:t,selectedFilters:s,setSelectedFilters:n}=e,o={specialist:t||[],language:["English","Hindi"],gender:["FEMALE","MALE"]},[c,r]=(0,l.useState)("specialist"),i=e=>{n(t=>{let s=t[c]||[],a=s.includes(e);return{...t,[c]:a?s.filter(t=>t!==e):[...s,e]}})};return(0,a.jsx)("div",{className:"container",children:(0,a.jsxs)("div",{className:"row popup-height",children:[(0,a.jsx)("div",{className:"col-md-4 left-tabs",children:(0,a.jsx)("div",{className:"d-flex flex-column",children:Object.keys(o).map(e=>(0,a.jsx)("button",{type:"button",className:"btn ".concat(c===e?"btn-primary":"btn-outline-secondary"),onClick:()=>r(e),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})}),(0,a.jsx)("div",{className:"col-md-8",children:(0,a.jsxs)("div",{className:"main-skill",children:[(0,a.jsxs)("div",{className:"mb-3 d-flex gap-2",children:[(0,a.jsx)("button",{className:"btn btn-outline-success px-3",onClick:()=>{n(e=>({...e,[c]:[...o[c]||[]]}))},children:"Select All"}),(0,a.jsx)("button",{className:"btn btn-outline-warning px-3",onClick:()=>{n(e=>({...e,[c]:[]}))},children:"Clear"})]}),(0,a.jsx)("div",{className:"short-popup",children:(o[c]||[]).map((e,t)=>{var l;let n=null==(l=s[c])?void 0:l.includes(e);return(0,a.jsx)("div",{className:"form-check rounded d-flex align-items-center justify-content-between ".concat(n?"bg-light border-primary":""),onClick:()=>i(e),style:{cursor:"pointer"},children:(0,a.jsxs)("label",{className:"custom-radio-wrapper ".concat(n?"selected":""),children:[(0,a.jsx)("input",{type:"checkbox",checked:n,onChange:()=>i(e),style:{display:"none"}}),(0,a.jsx)("span",{className:"custom-radio"}),(0,a.jsx)("span",{className:"label-text",children:e})]})},t)})})]})})]})})},r=function(e){let{selectedSort:t,setSelectedSort:s}=e;return(0,a.jsx)("div",{className:"w-100 bg-white p-3",children:(0,a.jsx)("div",{className:"mt-3 short-popup",children:[{id:"sort_0",value:"",label:"Popularity"},{id:"sort_1",value:"sortByExperience_1",label:"Experience : High to Low"},{id:"sort_2",value:"sortByExperience_0",label:"Experience : Low to High"},{id:"sort_5",value:"sortByPrice_1",label:"Price : High to Low"},{id:"sort_6",value:"sortByPrice_0",label:"Price : Low to High"},{id:"sort_7",value:"sortByRating_1",label:"Rating : High to Low"}].map(e=>{let l=t===e.value;return(0,a.jsxs)("div",{className:"form-check mb-2 rounded d-flex align-items-center justify-content-between ".concat(l?"bg-light border-primary":""),children:[(0,a.jsx)("div",{children:(0,a.jsxs)("label",{className:"custom-radio-wrapper ".concat(t===e.value?"selected":""),children:[(0,a.jsx)("input",{type:"radio",name:"sorting",value:e.value,checked:t===e.value,onChange:e=>s(e.target.value)}),(0,a.jsx)("span",{className:"custom-radio"}),(0,a.jsx)("span",{className:"label-text",children:e.label})]},e.id)}),l&&(0,a.jsx)("span",{className:"text-success fw-bold",children:"✔"})]},e.id)})})})};var i=s(6460);let d=function(e){let{searchQuery:t,setSearchQuery:s,data:n,setFilteredData:i,balance:d}=e,[m,u]=(0,l.useState)(""),[h,g]=(0,l.useState)({gender:[],specialist:[],language:[]}),x=[...new Set(n.flatMap(e=>Array.isArray(e.specialist)?e.specialist:[e.specialist]))].filter(Boolean),p=e=>parseFloat(e.replace(/[^\d.]/g,""))||0;return(0,l.useEffect)(()=>{""===t?i(n):i(n.filter(e=>{var s;return null==(s=e.name)?void 0:s.toLowerCase().includes(t.toLowerCase())}))},[t,n]),(0,a.jsxs)("div",{className:"mt-5 pt-3",children:[(0,a.jsx)("div",{className:"container py-3",children:(0,a.jsxs)("div",{className:"row gy-3 align-items-center",children:[(0,a.jsx)("div",{className:"col-12 col-md-auto ps-0",children:(0,a.jsx)("h2",{className:"bg-theme-dark",children:"Chat with Astrologer"})}),(0,a.jsx)("div",{className:"col-12 col-md-auto text-center text-md-start",children:(0,a.jsxs)("span",{className:"fs-6",children:["Available balance: ₹ ",d]})}),(0,a.jsx)("div",{className:"col-12 col-md-auto",children:(0,a.jsx)(o(),{href:"/wallet-recharge",className:"btn btn-outline-success w-100",children:"Recharge"})}),(0,a.jsx)("div",{className:"col d-none d-lg-block"}),(0,a.jsx)("div",{className:"col-6 col-md-auto",children:(0,a.jsx)("button",{className:"btn btn-outline-secondary w-100 d-flex align-items-center justify-content-center gap-2","data-bs-toggle":"modal","data-bs-target":"#FilterModal",children:(0,a.jsxs)("span",{children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-funnel",viewBox:"0 0 16 16",children:(0,a.jsx)("path",{d:"M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5zm1 .5v1.308l4.372 4.858A.5.5 0 0 1 7 8.5v5.306l2-.666V8.5a.5.5 0 0 1 .128-.334L13.5 3.308V2z"})})," ","Filter"]})})}),(0,a.jsx)("div",{className:"col-6 col-md-auto",children:(0,a.jsx)("button",{className:"btn btn-outline-secondary w-100 d-flex align-items-center justify-content-center gap-2","data-bs-toggle":"modal","data-bs-target":"#ShortModal",children:(0,a.jsxs)("span",{children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-sort-down",viewBox:"0 0 16 16",children:(0,a.jsx)("path",{d:"M3.5 2.5a.5.5 0 0 0-1 0v8.793l-1.146-1.147a.5.5 0 0 0-.708.708l2 1.999.007.007a.497.497 0 0 0 .7-.006l2-2a.5.5 0 0 0-.707-.708L3.5 11.293zm3.5 1a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5M7.5 6a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1zm0 3a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1zm0 3a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1z"})})," ","Sort by"]})})}),(0,a.jsx)("div",{className:"col-12 col-lg-3 pe-0",children:(0,a.jsxs)("div",{className:"input-group",children:[(0,a.jsx)("input",{type:"text",className:"form-control",placeholder:"Search name...",value:t,onChange:e=>s(e.target.value)}),(0,a.jsx)("button",{className:"btn btn-search bg-theme-dark",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-search",viewBox:"0 0 16 16",children:(0,a.jsx)("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"})})})]})})]})}),(0,a.jsx)("div",{className:"modal fade",id:"FilterModal",tabIndex:"-1","aria-labelledby":"FilterModalLabel","aria-hidden":"true",children:(0,a.jsx)("div",{className:"modal-dialog",children:(0,a.jsxs)("div",{className:"modal-content",children:[(0,a.jsxs)("div",{className:"modal-header bg-popup-header",children:[(0,a.jsx)("h3",{className:"modal-title fs-5",id:"FilterModalLabel",children:"Filter Options"}),(0,a.jsx)("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),(0,a.jsx)("div",{className:"modal-body filter-body",children:(0,a.jsx)(c,{specialistList:x,selectedFilters:h,handleCheckboxChange:(e,t)=>{g(s=>{let a={...s};return a[e].includes(t)?a[e]=a[e].filter(e=>e!==t):a[e]=[...a[e],t],a})},setSelectedFilters:g})}),(0,a.jsxs)("div",{className:"d-flex justify-content-around align-items-center modal-footer",children:[(0,a.jsx)("button",{type:"button",className:"btn btn-outline-info px-5",onClick:()=>{g({gender:[],specialist:[],language:[]}),i(n)},children:"Reset"}),(0,a.jsx)("button",{type:"button",className:"btn btn-outline-success px-5",onClick:()=>{let e=[...n];h.gender.length&&(e=e.filter(e=>h.gender.includes(e.gender))),h.specialist.length&&(e=e.filter(e=>{let t=e.specialist;return Array.isArray(t)?t.some(e=>h.specialist.includes(e)):h.specialist.includes(t)})),h.language.length&&(e=e.filter(e=>h.language.includes(e.language))),i(e)},"data-bs-dismiss":"modal",children:"Apply"})]})]})})}),(0,a.jsx)("div",{className:"modal fade",id:"ShortModal",tabIndex:"-1","aria-labelledby":"ShortModalLabel","aria-hidden":"true",children:(0,a.jsx)("div",{className:"modal-dialog",children:(0,a.jsxs)("div",{className:"modal-content",children:[(0,a.jsxs)("div",{className:"modal-header bg-popup-header",children:[(0,a.jsx)("h1",{className:"modal-title fs-5",id:"ShortModalLabel",children:"Sort Options"}),(0,a.jsx)("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),(0,a.jsx)("div",{className:"modal-body",children:(0,a.jsx)(r,{selectedSort:m,setSelectedSort:u})}),(0,a.jsxs)("div",{className:"d-flex justify-content-around align-items-center modal-footer",children:[(0,a.jsx)("button",{type:"button",className:"btn btn-outline-info px-5",onClick:()=>{u(""),i(n)},"data-bs-dismiss":"modal",children:"Reset"}),(0,a.jsx)("button",{type:"button",className:"btn btn-outline-success px-5",onClick:()=>{(e=>{if(!e)return i(n);let t=[...n];switch(e){case"sortByExperience_1":t.sort((e,t)=>{let s=parseInt(e.experience)||0;return(parseInt(t.experience)||0)-s});break;case"sortByExperience_0":t.sort((e,t)=>(parseInt(e.experience)||0)-(parseInt(t.experience)||0));break;case"sortByPrice_1":t.sort((e,t)=>p(t.chat_charge)-p(e.chat_charge));break;case"sortByPrice_0":t.sort((e,t)=>p(e.chat_charge)-p(t.chat_charge))}i(t)})(m)},"data-bs-dismiss":"modal",children:"Apply"})]})]})})})]})};var m=s(9619),u=s(9099),h=s(2491),g=s.n(h),x=s(8581),p=s(7431);let b=function(){var e,t,s,n,c,r;let h=(0,u.useRouter)(),[b,f]=(0,l.useState)([]),[v,j]=(0,l.useState)(""),[N,w]=(0,l.useState)([]),[y,S]=(0,l.useState)([]),[_,k]=(0,l.useState)(!1),[C,I]=(0,l.useState)(!1),[A,E]=(0,l.useState)(!1),[L,M]=(0,l.useState)(!1),[O,F]=(0,l.useState)(!1),[T,J]=(0,l.useState)({}),[B,z]=(0,l.useState)(0),[R,P]=(0,l.useState)([]),[q,H]=(0,l.useState)({}),[Y,W]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=localStorage.getItem("ongoing_chat");if(e){let{astrologer:t}=JSON.parse(e);W(t)}},[]),(0,l.useEffect)(()=>{let e=localStorage.getItem("selected_consultants");if(e){console.log("storedstoredstoredstored",e);try{P(JSON.parse(e)),k(!0)}catch(e){console.error(e)}}},[]),(0,l.useEffect)(()=>{var e;let t=JSON.parse(localStorage.getItem("user")||"{}"),s=(null==t||null==(e=t.user)?void 0:e.id)||(null==t?void 0:t.id);if(!s)return;(0,p.b0)(s);let a=(0,p.pY)(e=>{console.log(" under subscribeToChatAccepted function in chat list"),console.log("✅ Astrologer accepted the chat request:",e),g().fire({icon:"success",title:"Astrologer Accepted",text:"You can now start chatting!",timer:8e3,showConfirmButton:!1}),e.senderId===s&&P(t=>{let s=t.map(t=>t.id===e.receiverId?{...t,astrologerAccepted:!0}:t);return localStorage.setItem("selected_consultants",JSON.stringify(s)),console.log("✅ Updated selectedConsultant after astrologer accepted:",s),s})});return()=>a()},[]),(0,l.useEffect)(()=>{let e=localStorage.getItem("selected_consultants");if(e)try{let t=JSON.parse(e);Array.isArray(t)&&t.some(e=>e.astrologerAccepted)&&(console.log("♻️ Restoring accepted state from localStorage"),P(t))}catch(e){console.error("Failed to rehydrate consultant data:",e)}},[]),(0,l.useEffect)(()=>{E(!!localStorage.getItem("token"))},[]),(0,l.useEffect)(()=>{let e=localStorage.getItem("selected_consultants");if(e)try{let t=JSON.parse(e);Array.isArray(t)&&P(t)}catch(e){console.error("Failed to parse stored consultants:",e)}},[]);let D=()=>"Wait ~ ".concat(Math.floor(10*Math.random())+1," min");(0,l.useEffect)(()=>{let e=async()=>{try{let e=await (0,x.W)("".concat(i.v.base_url,"vendors"),{method:"GET"}),t=await e.json(),s=Array.isArray(t.data)?t.data:[];f(e=>{let t=s.map(t=>{let s=e.find(e=>e.id===t.id),a=t.chat_charge||0,l=t.admin_chat_charge||0;return{id:t.id,first_name:t.first_name,specialist:t.specialist,language:t.language,gender:t.gender,experience:"".concat(t.experience," Years"),image:t.image,chat_charge:"₹ ".concat(Math.round(a+a*l/100),"/min"),rating:"★★★★★",orders:"1000+ orders",is_login:t.is_login,celebrity:"Psychic"===t.specialist?"Celebrity":null,waitTime:t.is_login?null:(null==s?void 0:s.waitTime)||D()}});return w(t),t})}catch(e){console.error("Failed to fetch consultants",e)}};e();let t=setInterval(()=>{f(e=>e.map(e=>e.is_login?e:{...e,waitTime:D()}))},3e4),s=setInterval(()=>{e()},3e4);return()=>{clearInterval(t),clearInterval(s)}},[]),(0,l.useEffect)(()=>{let e=async()=>{var e,t;let s=localStorage.getItem("token"),a=JSON.parse(localStorage.getItem("user")||"{}"),l=(null==a?void 0:a.id)||(null==a||null==(e=a.user)?void 0:e.id);if(!s||!l)return void z(0);try{let e=await (0,x.W)("".concat(i.v.base_url,"payment/").concat(l),{method:"GET",headers:{Authorization:"Bearer ".concat(s)}}),a=await e.json();z((null==(t=a.data)?void 0:t.amount)||0)}catch(e){console.error("Balance fetch error:",e),z(0)}};e();let t=()=>{e()},s=()=>{z(0)};window.addEventListener("userLoggedIn",t),window.addEventListener("userLoggedOut",s);let a=t=>{("token"===t.key||"user"===t.key)&&e()};return window.addEventListener("storage",a),()=>{window.removeEventListener("userLoggedIn",t),window.removeEventListener("userLoggedOut",s),window.removeEventListener("storage",a)}},[]);let V=async e=>{try{var t;let s=localStorage.getItem("token"),a=JSON.parse(localStorage.getItem("user")||"{}"),l=(null==a?void 0:a.id)||(null==a||null==(t=a.user)?void 0:t.id);if(!s||!l||!(null==e?void 0:e.id))return;window.socket||(0,p.b0)(l,e.id),setTimeout(()=>{window.socket.emit("request_chat",{senderId:l,receiverId:e.id,roomId:(0,p.$d)(l,e.id)})},500)}catch(e){console.error("Failed to start chat:",e)}};(0,l.useEffect)(()=>{_&&(null==R?void 0:R.id)&&V(R)},[_,R]);let G=(y.length?y:b).filter(e=>e.first_name.toLowerCase().includes(v.toLowerCase()));return(0,l.useEffect)(()=>{if(!window.socket||!window.socket.connected)return;let e=e=>{let{roomId:t}=e;console.log("✅ Chat accepted by astrologer for room:",t),J(e=>({...e,[t]:"accepted"}))};return window.socket.on("chat_accepted",e),()=>{window.socket.off("chat_accepted",e)}},[null==(e=window.socket)?void 0:e.connected]),(0,l.useEffect)(()=>{if(!window.socket||!window.socket.connected)return;let e=e=>{let{roomId:t}=e;console.log("✅ [Global Socket Listener] Chat accepted in room:",t)};return window.socket.on("chat_accepted",e),()=>{window.socket.off("chat_accepted",e)}},[null==(t=window.socket)?void 0:t.connected]),(0,a.jsxs)("div",{className:"main-card-section mb-5 mt-5",children:[(0,a.jsxs)("div",{className:"container",children:[(0,a.jsx)("div",{className:"row",children:(0,a.jsx)("div",{className:"col-12",children:(0,a.jsx)(d,{searchQuery:v,setSearchQuery:j,data:N,setFilteredData:S,balance:B})})}),(0,a.jsx)("div",{className:"row g-4",children:G.map(e=>(0,a.jsx)("div",{className:"col-12 col-sm-6 col-lg-4",children:(0,a.jsxs)("div",{className:"card border shadow-sm position-relative p-3",children:[(0,a.jsx)("img",{src:"https://d1gcna0o0ldu5v.cloudfront.net/fit-in/24x24/assets/images/Chat_with_astrologers/webp/tick_icon.webp",alt:"Verified",className:"position-absolute top-0 end-0 m-2",width:"16",height:"16"}),(0,a.jsxs)("div",{className:"d-flex align-items-center mb-1",children:[(0,a.jsx)("div",{className:"me-3",children:(0,a.jsx)(o(),{href:"/vendordetail/".concat(e.id),children:(0,a.jsx)("img",{src:e.image,alt:e.first_name,className:"rounded-circle border border-secondary",style:{width:"70px",height:"70px",objectFit:"cover"}})})}),(0,a.jsxs)("div",{className:"text-astro",children:[(0,a.jsx)("h5",{children:e.first_name}),(0,a.jsx)("p",{className:"mb-0 text-muted small",children:e.specialist}),(0,a.jsx)("p",{className:"mb-0 text-muted small",children:e.language})]})]}),(0,a.jsxs)("div",{className:"d-flex justify-content-between align-items-start mb-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-warning mb-1",children:[(0,a.jsx)("strong",{children:e.rating}),(0,a.jsxs)("span",{className:"text-muted ms-2 text-12",children:["Exp: ",e.experience]})]}),(0,a.jsx)("div",{className:"fw-bold text-danger text-12",children:e.chat_charge})]}),(0,a.jsx)("button",{onClick:()=>{if(!localStorage.getItem("token"))return void M(!0);let t=2*parseFloat(e.chat_charge.replace(/[^\d.]/g,""));if(B<t){P({name:e.first_name,requiredAmount:t}),F(!0);return}if(R.length>=3)return void g().fire("Limit Reached","You can request a maximum of 3 astrologers at once.","warning");P(t=>{let s=[...Array.isArray(t)?t:[],e];return localStorage.setItem("selected_consultants",JSON.stringify(s)),s}),V(e)},className:"btn px-3 ".concat(e.is_login?"btn-outline-success":"btn-outline-danger"," btn-sm mb-1"),children:"Chat"})]})]})},e.id))}),O&&(0,a.jsx)("div",{className:"modal fade show d-block",tabIndex:"-1","aria-labelledby":"waitingLabel","aria-hidden":!O,style:{backgroundColor:"rgba(0, 0, 0, 0.28)"},children:(0,a.jsx)("div",{className:"modal-dialog modal-dialog-centered modal-sm",children:(0,a.jsx)("div",{className:"modal-content",children:(0,a.jsxs)("div",{className:"modal-body",children:[(0,a.jsxs)("p",{className:"massage-text text-center",children:["Minimum balance of 2 minutes (₹",R.requiredAmount.toFixed(2),") is required to start chat with ",R.name]}),(0,a.jsxs)("div",{className:"d-flex justify-content-center",children:[(0,a.jsx)("button",{className:"btn btn-outline-success m-2",onClick:()=>F(!1),children:"Cancel"}),(0,a.jsx)(o(),{className:"btn btn-outline-success m-2",href:"/wallet-recharge",children:"Recharge"})]})]})})})}),L&&(0,a.jsx)("div",{className:"modal fade show d-block",tabIndex:"-1","aria-labelledby":"loginModalLabel","aria-hidden":!L,style:{backgroundColor:"rgba(0, 0, 0, 0.28)"},children:(0,a.jsx)("div",{className:"modal-dialog modal-dialog-centered custom-modal",children:(0,a.jsxs)("div",{className:"modal-content",children:[(0,a.jsxs)("div",{className:"modal-header custom-header-pop",children:[(0,a.jsx)("h5",{className:"modal-title w-100 text-center",id:"loginModalLabel",children:"Continue Login with Phone"}),(0,a.jsx)("button",{className:"btn-close btn-close-white",onClick:()=>M(!L),"aria-label":"Close"})]}),(0,a.jsxs)("div",{className:"modal-body",children:[(0,a.jsx)(m.A,{onLoginSuccess:e=>{localStorage.clear(),localStorage.setItem("token",e.token),localStorage.setItem("user",JSON.stringify({...e,type:"user"})),E(!0),M(!1)}}),(0,a.jsxs)("p",{className:"text-muted small text-center mt-3 term-policy",children:["By Signing up, you agree to our ",(0,a.jsx)(o(),{href:"#",children:"Terms & Conditions"})]})]})]})})}),R.length>0&&(0,a.jsx)("div",{className:"position-fixed d-flex justify-content-center",style:{bottom:"20px",left:0,right:0,zIndex:1055,gap:"10px"},children:R.map(e=>(0,a.jsx)("div",{style:{width:"300px"},children:(0,a.jsx)("div",{className:"modal-content shadow",children:(0,a.jsx)("div",{className:"modal-body p-0",children:(0,a.jsxs)("div",{className:"card d-flex flex-row align-items-center p-2",children:[(0,a.jsxs)("div",{className:"d-flex flex-column align-items-center me-3",children:[(0,a.jsx)("img",{src:e.image,alt:e.first_name,className:"rounded-circle border border-secondary",style:{width:"50px",height:"50px",objectFit:"cover"}}),(0,a.jsx)("span",{style:{fontSize:"11px",fontWeight:"600",marginTop:"4px",color:"#007bff"},children:"CHAT"})]}),(0,a.jsxs)("div",{className:"flex-grow-1",children:[(0,a.jsx)("div",{className:"fw-bold",children:e.first_name}),(0,a.jsx)("div",{className:"text-muted",children:e.chat_charge}),(0,a.jsxs)("div",{className:"small text-secondary",children:[e.astrologerAccepted?"You can now start chatting.":"Wait time - ".concat(q[e.id]||"..."," min"),(0,a.jsx)("span",{className:"ms-2 d-inline-block rounded-circle",style:{width:"10px",height:"10px",backgroundColor:e.astrologerAccepted?"blue":"green"}})]})]}),e.astrologerAccepted?(0,a.jsx)("button",{className:"btn btn-outline-primary btn-sm ms-1",onClick:()=>{var t,s;P(t=>{let s=t.filter(t=>t.id!==e.id);return localStorage.setItem("selected_consultants",JSON.stringify(s)),s});let a=localStorage.getItem("ongoing_chat");a&&(null==(s=JSON.parse(a))||null==(t=s.astrologer)?void 0:t.id)===e.id||localStorage.setItem("ongoing_chat",JSON.stringify({astrologer:e,timestamp:new Date().toISOString()})),h.push("/chat/".concat(e.id))},children:"Accept"}):(0,a.jsx)("button",{className:"btn btn-outline-danger btn-sm ms-1",onClick:()=>{P(t=>{let s=t.filter(t=>t.id!==e.id);return localStorage.setItem("selected_consultants",JSON.stringify(s)),s})},children:"Cancel"})]})})})},e.id))})]}),Y&&(0,a.jsx)("div",{className:"position-fixed d-flex justify-content-center",style:{bottom:"20px",left:0,right:0,zIndex:1055},children:(0,a.jsx)("div",{style:{width:"300px"},children:(0,a.jsx)("div",{className:"modal-content shadow",children:(0,a.jsx)("div",{className:"modal-body p-0",children:(0,a.jsxs)("div",{className:"card d-flex flex-row align-items-center p-2",children:[(0,a.jsxs)("div",{className:"d-flex flex-column align-items-center me-3",children:[(0,a.jsx)("img",{src:null==(n=JSON.parse(localStorage.getItem("ongoing_chat")))||null==(s=n.astrologer)?void 0:s.image,alt:"astrologer",className:"rounded-circle border border-secondary",style:{width:"50px",height:"50px",objectFit:"cover"}}),(0,a.jsx)("span",{style:{fontSize:"11px",fontWeight:"600",marginTop:"4px",color:"#007bff"},children:"CHAT"})]}),(0,a.jsxs)("div",{className:"flex-grow-1",children:[(0,a.jsx)("div",{className:"fw-bold",children:null==(r=JSON.parse(localStorage.getItem("ongoing_chat")))||null==(c=r.astrologer)?void 0:c.first_name}),(0,a.jsx)("div",{className:"text-muted small",children:"You have an ongoing chat session."}),(0,a.jsxs)("div",{className:"small text-secondary d-flex align-items-center mt-1",children:[(0,a.jsx)("span",{className:"me-2",children:"Tap to resume"}),(0,a.jsx)("span",{className:"d-inline-block rounded-circle",style:{width:"10px",height:"10px",backgroundColor:"blue"}})]})]}),(0,a.jsx)("button",{className:"btn btn-outline-primary btn-sm ms-1",onClick:()=>{var e;let t=JSON.parse(localStorage.getItem("ongoing_chat"));(null==t||null==(e=t.astrologer)?void 0:e.id)&&h.push("/chat/".concat(t.astrologer.id))},children:"Resume"})]})})})})})]})};function f(){return(0,a.jsx)(b,{})}},7431:(e,t,s)=>{"use strict";s.d(t,{$d:()=>n,G1:()=>m,SR:()=>r,_z:()=>c,b0:()=>o,mb:()=>i,pY:()=>d});var a=s(2692);let l=null,n=(e,t)=>[e,t].sort().join("-"),o=(e,t)=>{let s=n(e,t);return console.log("\uD83D\uDFE1 [initiateSocket] userId:",e,"receiverId:",t,"roomId:",s),new Promise(t=>{l||(l=(0,a.io)("http://www.astrobolo.com",{transports:["websocket"],query:{userId:e},withCredentials:!0}),window.socket=l),l.on("connect",()=>{console.log("✅ [Socket Connected] ID:",l.id),l.emit("join_room",s),console.log("\uD83D\uDCE9 [Join Room] roomId:",s),t(l)}),l.on("disconnect",()=>{console.log("\uD83D\uDD34 [Socket Disconnected]")})})},c=e=>{if(!l)return void console.log("❌ [sendMessage] Socket not initialized.");let t=n(e.sender_id,e.receiver_id);console.log("\uD83D\uDCE4 [sendMessage] Emitting to room:",t,"Message:",e),l.emit("sendMessage",{message:e,roomId:t})},r=e=>{if(!l)return;let t=t=>{console.log("\uD83D\uDCEC [subscribeToMessages] Received message:",t),e(t)};return l.on("receiveMessage",t),()=>{l.off("receiveMessage",t)}},i=e=>{if(!l)return;let t=t=>{console.log("\uD83D\uDCE8 [subscribeToChatRequests] Incoming:",t),e(t)};return l.on("request_chat",t),()=>{l.off("request_chat",t)}},d=e=>{if(console.log(" under subscribeToChatAccepted function in socket"),!l)return;let t=t=>{console.log("✅ [subscribeToChatAccepted] Chat accepted by astrologer:",t),e(t)};return l.on("chat_accepted",t),console.log("socket chat accepted 1"),()=>{console.log("socket chat accepted 2"),l.off("chat_accepted",t)}},m=()=>{l&&(console.log("\uD83D\uDD0C [disconnectSocket] Disconnecting..."),l.disconnect(),l=null)}}},e=>{e.O(0,[692,491,636,593,792],()=>e(e.s=3484)),_N_E=e.O()}]);