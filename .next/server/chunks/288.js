"use strict";exports.id=288,exports.ids=[288],exports.modules={300:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{$d:()=>h,G1:()=>n,SR:()=>k,_z:()=>j,b0:()=>i,mb:()=>l,pY:()=>m});var e=c(717),f=a([e]);e=(f.then?(await f)():f)[0];let g=null,h=(a,b)=>[a,b].sort().join("-"),i=(a,b)=>{let c=h(a,b);return console.log("\uD83D\uDFE1 [initiateSocket] userId:",a,"receiverId:",b,"roomId:",c),new Promise(b=>{g||(g=(0,e.io)("http://www.astrobolo.com",{transports:["websocket"],query:{userId:a},withCredentials:!0})),g.on("connect",()=>{console.log("✅ [Socket Connected] ID:",g.id),g.emit("join_room",c),console.log("\uD83D\uDCE9 [Join Room] roomId:",c),b(g)}),g.on("disconnect",()=>{console.log("\uD83D\uDD34 [Socket Disconnected]")})})},j=a=>{if(!g)return void console.log("❌ [sendMessage] Socket not initialized.");let b=h(a.sender_id,a.receiver_id);console.log("\uD83D\uDCE4 [sendMessage] Emitting to room:",b,"Message:",a),g.emit("sendMessage",{message:a,roomId:b})},k=a=>{if(!g)return;let b=b=>{console.log("\uD83D\uDCEC [subscribeToMessages] Received message:",b),a(b)};return g.on("receiveMessage",b),()=>{g.off("receiveMessage",b)}},l=a=>{if(!g)return;let b=b=>{console.log("\uD83D\uDCE8 [subscribeToChatRequests] Incoming:",b),a(b)};return g.on("request_chat",b),()=>{g.off("request_chat",b)}},m=a=>{if(console.log(" under subscribeToChatAccepted function in socket"),!g)return;let b=b=>{console.log("✅ [subscribeToChatAccepted] Chat accepted by astrologer:",b),a(b)};return g.on("chat_accepted",b),console.log("socket chat accepted 1"),()=>{console.log("socket chat accepted 2"),g.off("chat_accepted",b)}},n=()=>{g&&(console.log("\uD83D\uDD0C [disconnectSocket] Disconnecting..."),g.disconnect(),g=null)};d()}catch(a){d(a)}})},5425:(a,b,c)=>{c.r(b),c.d(b,{default:()=>f});var d=c(8732),e=c(2341);function f(){return(0,d.jsxs)(e.Html,{lang:"en",children:[(0,d.jsx)(e.Head,{}),(0,d.jsxs)("body",{children:[(0,d.jsx)(e.Main,{}),(0,d.jsx)(e.NextScript,{})]})]})}},7942:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{A:()=>m});var e=c(2015),f=c(4233),g=c(9236),h=c.n(g),i=c(300),j=c(621),k=c(5072),l=a([i]);function m(a,b,c){let d=(0,f.useRouter)(),{customerId:g}=d.query,l=(0,e.useRef)(!1),m=(0,e.useRef)(!1);(0,e.useRef)([]),(0,e.useRef)(!1),(0,e.useRef)(!1),(0,e.useRef)(!1);let[n,o]=(0,e.useState)([]),[p,q]=(0,e.useState)(""),[r,s]=(0,e.useState)(0),[t,u]=(0,e.useState)(0),v={}.user?.id;"astrologer"===b||a?.id;let[w,x]=(0,e.useState)(()=>new Date),y=async(b=!1)=>{let c=Math.floor((new Date-w)/1e3);if(c<20&&m.current&&!b)return void h().fire("You can end the chat only after 1 minute.","","info");if(l.current)return;if(l.current=!0,localStorage.removeItem("ongoing_chat"),!a)return void console.error("Missing astrologer data while ending chat.");let e=a.chat_charge||5,f=Math.min(c/60,r/e),g=parseFloat((f*e).toFixed(2)),n=localStorage.getItem("token"),o={user_id:String(v),astrologer_id:String(a.id),chat_id:String(a.id),duration_minutes:f,total_charge:g};try{let c=await (0,k.W)(`${j.v.base_url}chat/chat_transation`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(o)}),e=await c.json();if(!c.ok||!e?.status)return void h().fire("Failed to save chat transaction","","error");let f=await (0,k.W)(`${j.v.base_url}payment/update-balance/${v}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({amount:g})}),l=await f.json();f.ok&&l?.status||h().fire("Chat saved, but balance update failed","","warning"),window?.socket&&window.socket.emit("end_chat_by_customer",{senderId:v,receiverId:a.id,roomId:`${(0,i.$d)(v,a.id)}`}),h().fire("Chat ended","","success").then(()=>{localStorage.removeItem("chat_messages"),d.push(b?"/wallet-recharge":"/astrologer")})}catch(a){console.error("Transaction failed",a),h().fire("Something went wrong","","error")}};return{messages:n,input:p,setInput:q,setMessages:o,sendMessage:()=>{if(!p.trim())return;let c=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),d="astrologer"===b?g:a?.id;q(""),(0,i._z)({message:p,time:c,isSent:!0,sender_id:v,receiver_id:d})},sendImageMessage:c=>{let d=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),e="astrologer"===b?g:a?.id;(0,i._z)({message:c,time:d,isSent:!0,isImage:!0,sender_id:v,receiver_id:e})},remainingTime:t,formatTime:a=>{let b=String(Math.floor(a/60)).padStart(2,"0"),c=String(a%60).padStart(2,"0");return`${b}:${c}`},handleEndChat:y,setEndClicked:()=>m.current=!0}}i=(l.then?(await l)():l)[0],d()}catch(a){d(a)}})}};